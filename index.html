<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–∫—Ä—ã—Ç–∏–µ –ö–µ–π—Å–æ–≤</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1c1f26; /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
            color: #ffffff; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #2d313a; /* –ù–µ–º–Ω–æ–≥–æ —Å–≤–µ—Ç–ª–µ–µ —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        h1 {
            color: #ffd700; /* –ó–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
            text-align: center;
            margin-bottom: 10px;
        }
        .info {
             background-color: #3a3f4d; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ */
             padding: 15px;
             border-radius: 10px;
             margin-bottom: 20px;
        }
        .info p {
            margin: 5px 0;
        }
        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .case-item {
            background-color: #444957;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            position: relative; /* –î–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ü–µ–Ω—ã */
        }
         .case-item:hover {
             transform: scale(1.05);
             background-color: #555a69;
         }
        .case-emoji {
            font-size: 2.5em;
            display: block;
            margin-bottom: 10px;
        }
        .case-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .case-cost {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff6b6b; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è —Ü–µ–Ω—ã */
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .case-win {
            font-size: 0.8em;
            color: #aaa;
        }
        .hidden {
            display: none;
        }
        button {
            background-color: #4CAF50; /* –ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
            border: none;
            color: white;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 5px;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #resultModal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #2d313a;
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 15px;
        }
        .close:hover,
        .close:focus {
            color: #fff;
        }
        #loadingSpinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .notification {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
        .notification.success { background-color: #4CAF50; color: white; }
        .notification.error { background-color: #f44336; color: white; }
        .notification.info { background-color: #2196F3; color: white; }

    </style>
</head>
<body>
    <div class="container">
        <h1>üîÆ –ö–µ–π—Å—ã –£–¥–∞—á–∏</h1>
        <div id="userInfo" class="info">
            <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span id="displayUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            <p><strong>–ó–≤—ë–∑–¥:</strong> <span id="displayStars">–ó–∞–≥—Ä—É–∑–∫–∞...</span> ‚≠ê</p>
            <p><small>ID: <span id="displayUserId">-</span></small></p>
        </div>

        <div id="notifications"></div> <!-- –ë–ª–æ–∫ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->

        <div id="casesSection">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å:</h2>
            <div id="caseGrid" class="case-grid">
                <!-- –ö–µ–π—Å—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <div id="resultModal" class="hidden">
            <div class="modal-content">
                <span class="close">&times;</span>
                 <div id="modalBody">
                     <div id="loadingSpinner"></div>
                     <p>–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–µ–π—Å...</p>
                 </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App SDK
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å—à–∏—Ä—è–µ–º WebApp –Ω–∞ –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ä–∞–∑–º–µ—Ä
        tg.MainButton.hide(); // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id');
        const username = urlParams.get('username');
        const stars = parseFloat(urlParams.get('stars'));

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        document.getElementById('displayUserId').textContent = userId || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        document.getElementById('displayUsername').textContent = username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        document.getElementById('displayStars').textContent = isNaN(stars) ? '0.00' : stars.toFixed(2);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        if (!userId || !username) {
             showNotification('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram.', 'error');
             // –ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å WebApp –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
             // tg.close();
        } else {
            console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${username}, ID: ${userId}, –ó–≤—ë–∑–¥: ${stars}`);
            loadCases(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–µ–π—Å—ã –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–µ–π—Å–æ–≤ (–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞)
        const CASES = [
            {
                id: 1,
                name: "–ë—Ä–æ–Ω–∑–æ–≤—ã–π –ö–µ–π—Å",
                emoji: "ü•â",
                cost: 10,
                min_win: 1,
                max_win: 30,
                description: "–ù–∞—á–∞–ª—å–Ω—ã–π –∫–µ–π—Å –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤"
            },
            {
                id: 2,
                name: "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ö–µ–π—Å",
                emoji: "ü•à",
                cost: 50,
                min_win: 5,
                max_win: 100,
                description: "–°—Ä–µ–¥–Ω–∏–π –∫–µ–π—Å —Å —Ö–æ—Ä–æ—à–∏–º–∏ —à–∞–Ω—Å–∞–º–∏"
            },
            {
                id: 3,
                name: "–ó–æ–ª–æ—Ç–æ–π –ö–µ–π—Å",
                emoji: "ü•á",
                cost: 100,
                min_win: 10,
                max_win: 300,
                description: "–ü—Ä–µ–º–∏—É–º –∫–µ–π—Å —Å –±–æ–ª—å—à–∏–º–∏ –≤—ã–∏–≥—Ä—ã—à–∞–º–∏"
            },
            {
                id: 4,
                name: "–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π –ö–µ–π—Å",
                emoji: "üíé",
                cost: 500,
                min_win: 50,
                max_win: 1000,
                description: "–≠–ª–∏—Ç–Ω—ã–π –∫–µ–π—Å –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤"
            },
            {
                id: 5,
                name: "–ö–µ–π—Å –ü–æ–¥–∞—Ä–∫–æ–≤",
                emoji: "üéÄ",
                cost: 35,
                // –î–ª—è –∫–µ–π—Å–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –≤—ã–∏–≥—Ä—ã—à - ID –ø–æ–¥–∞—Ä–∫–∞
                description: "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–µ–π—Å —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏"
            }
        ];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–µ–π—Å–æ–≤
        function loadCases() {
            const gridContainer = document.getElementById('caseGrid');
            gridContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–æ–π

            CASES.forEach(caseItem => {
                const caseElement = document.createElement('div');
                caseElement.className = 'case-item';
                caseElement.dataset.caseId = caseItem.id;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã—Ç—å —ç—Ç–æ—Ç –∫–µ–π—Å
                const canAfford = stars >= caseItem.cost;

                caseElement.innerHTML = `
                    <span class="case-cost">${caseItem.cost} ‚≠ê</span>
                    <span class="case-emoji">${caseItem.emoji}</span>
                    <div class="case-name">${caseItem.name}</div>
                    ${
                        caseItem.id === 5 ?
                        '<div class="case-win">üéÅ –°–ª—É—á–∞–π–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫</div>' :
                        `<div class="case-win">üí∞ ${caseItem.min_win} - ${caseItem.max_win} –∑–≤—ë–∑–¥</div>`
                    }
                `;

                if (canAfford) {
                    caseElement.addEventListener('click', () => openCase(caseItem));
                } else {
                    caseElement.style.opacity = '0.5'; // –í–∏–∑—É–∞–ª—å–Ω–æ –∑–∞—Ç–µ–Ω—è–µ–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ
                    caseElement.title = `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥. –ù—É–∂–Ω–æ ${caseItem.cost}`;
                }

                gridContainer.appendChild(caseElement);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
        async function openCase(caseItem) {
            console.log(`–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å: ${caseItem.name}`);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            const modal = document.getElementById('resultModal');
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div id="loadingSpinner"></div>
                <p>üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞ "${caseItem.emoji} ${caseItem.name}"...</p>
            `;
            modal.classList.remove('hidden');

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
            document.querySelector('.close').onclick = function() {
                modal.classList.add('hidden');
            }
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.classList.add('hidden');
                }
            }

            try {
                // --- 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ –Ω–∞—à –±—ç–∫–µ–Ω–¥ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è –∑–≤—ë–∑–¥ ---
                // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç fetch –∫ –≤–∞—à–µ–º—É API
                // –ù–∞–ø—Ä–∏–º–µ—Ä: const response = await fetch('/api/open_case', { ... });

                // --- –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –±—ç–∫–µ–Ω–¥–∞ ---
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–∞ –ª–æ–≥–∏–∫–∞ –±—É–¥–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Python/Flask/Django/etc.)
                await new Promise(resolve => setTimeout(resolve, 2000)); // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (–¥—É–±–ª–∏—Ä—É–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–ª—è UX, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞)
                if (window.currentStarsForSim < caseItem.cost) {
                     throw new Error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥ (—Å–∏–º—É–ª—è—Ü–∏—è).");
                }
                window.currentStarsForSim -= caseItem.cost; // –°–ø–∏—Å—ã–≤–∞–µ–º –∑–≤—ë–∑–¥—ã (—Å–∏–º—É–ª—è—Ü–∏—è)

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à (—Å–∏–º—É–ª—è—Ü–∏—è)
                let winResult;
                if (caseItem.id === 5) {
                    // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞
                    const gifts = [
                        {id: 1, emoji: "üß∏", name: "–ú–∏—à–∫–∞", value: 15},
                        {id: 2, emoji: "üíù", name: "–°–µ—Ä–¥—Ü–µ", value: 15},
                        {id: 3, emoji: "üéÅ", name: "–ü–æ–¥–∞—Ä–æ–∫", value: 25},
                        {id: 4, emoji: "üåπ", name: "–†–æ–∑–∞", value: 25},
                        // ... –¥—Ä—É–≥–∏–µ –ø–æ–¥–∞—Ä–∫–∏
                    ];
                    winResult = gifts[Math.floor(Math.random() * gifts.length)];
                } else {
                    // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–≤—ë–∑–¥
                    const range = caseItem.max_win - caseItem.min_win;
                    // –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞: —á–∞—â–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –≤—ã–∏–≥—Ä—ã—à–∏
                    const rand = Math.random();
                    let winAmount;
                    if (rand < 0.6) {
                        winAmount = caseItem.min_win + Math.random() * range * 0.3; // 60% - –Ω–∏–∑–∫–∏–π –≤—ã–∏–≥—Ä—ã—à
                    } else if (rand < 0.9) {
                        winAmount = caseItem.min_win + range * 0.3 + Math.random() * range * 0.5; // 30% - —Å—Ä–µ–¥–Ω–∏–π
                    } else {
                        winAmount = caseItem.min_win + range * 0.8 + Math.random() * range * 0.2; // 10% - –≤—ã—Å–æ–∫–∏–π
                    }
                    winResult = Math.max(caseItem.min_win, Math.floor(winAmount));
                }

                // --- 2. –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º ---
                await new Promise(resolve => setTimeout(resolve, 1000)); // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

                let resultHTML = `<h2>${caseItem.emoji} –ö–µ–π—Å –æ—Ç–∫—Ä—ã—Ç!</h2>`;
                if (caseItem.id === 5 && winResult.emoji) {
                    resultHTML += `
                        <p>üéä –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏:</p>
                        <p style="font-size: 3em;">${winResult.emoji}</p>
                        <p><strong>${winResult.name}</strong> (${winResult.value} ‚≠ê)</p>
                        <p>üéÅ –ü–æ–¥–∞—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –±–æ—Ç–∞!</p>
                    `;
                     showNotification(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winResult.emoji} ${winResult.name}!`, 'success');
                } else if(typeof winResult === 'number') {
                    resultHTML += `
                        <p>üéä –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏:</p>
                        <p style="font-size: 2em;">‚≠ê ${winResult} –∑–≤—ë–∑–¥</p>
                    `;
                    showNotification(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${winResult} –∑–≤—ë–∑–¥!`, 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–≤—ë–∑–¥
                    window.currentStarsForSim += winResult;
                    document.getElementById('displayStars').textContent = window.currentStarsForSim.toFixed(2);
                } else {
                     resultHTML += `<p>‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>`;
                }
                resultHTML += `<button onclick="document.getElementById('resultModal').classList.add('hidden');">OK</button>`;
                modalBody.innerHTML = resultHTML;


                // --- 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ Telegram Web App API) ---
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±–æ—Ç—É –æ –≤—ã–∏–≥—Ä—ã—à–µ
                // tg.sendData(JSON.stringify({action: "case_opened", case_id: caseItem.id, result: winResult}));

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–µ–π—Å–∞:", error);
                modalBody.innerHTML = `
                    <h2>‚ùå –û—à–∏–±–∫–∞</h2>
                    <p>–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å: ${error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞.'}</p>
                    <button onclick="document.getElementById('resultModal').classList.add('hidden');">–ó–∞–∫—Ä—ã—Ç—å</button>
                `;
                 showNotification(`–û—à–∏–±–∫–∞: ${error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.'}`, 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            container.appendChild(notification);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–≤—ë–∑–¥ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
        window.currentStarsForSim = isNaN(stars) ? 0 : stars;

    </script>
</body>
</html>
